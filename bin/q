#!/bin/bash

QUERY=$(echo "" | dmenu -p "search")
[ "$QUERY" ] || exit

DIRS=$(find ~/ -maxdepth 2 -type d -not -path '*/\.*' -iname "*$QUERY*")
FILES=$(ag -i -g "$QUERY" ~/)

CHOICE=$(echo -e "$DIRS"$'\n'"$FILES" | dmenu -l 10 -p "results")
while [ -d "$CHOICE" ]; do
    CHOICE=$CHOICE/$(ls "$CHOICE" | dmenu -l 10 -p "directory")
done
[ "$CHOICE" ] || exit

function float {
    bspc rule -a $1 -o floating=on
}

case "$CHOICE" in
    *.png|*.jpg|*.jpeg) feh --scale-down "$CHOICE";;
    *.mkv|*.mp4|*.webm) float mpv && mpv --autofit=50%x50% "$CHOICE";;
    *.gif) gifview -a "$CHOICE";;
    *.pdf) float zathura && zathura "$CHOICE";;
    *.md) float urxvt && urxvt -e vi "$CHOICE";;
    *) notify-send "unrecognized extension";;
esac